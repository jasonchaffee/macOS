#!/usr/bin/env zsh

# Usage: install-tool <type>:<package>[@version]
# Types: brew, brew-cask, mise, npm
# Returns: 0 on success, 1 on failure

entry=$1
# Strip comments and whitespace
entry=${entry%%#*}
entry=${entry%% *}
entry=${entry%%	*}

type=${entry%%:*}
package_with_version=${entry#*:}
package=${package_with_version%%@*}
version=${package_with_version#*@}
[[ "$version" == "$package" ]] && version="latest"

case $type in
    brew)
        if command -v brew >/dev/null 2>&1; then
            echo "Installing brew package: $package"
            brew install $package
            exit $?
        fi
        ;;
    brew-cask)
        if command -v brew >/dev/null 2>&1; then
            echo "Installing brew cask: $package"
            brew install --cask $package
            exit $?
        fi
        ;;
    mise)
        if command -v mise >/dev/null 2>&1; then
            echo "Installing mise tool: ${package}@${version}"
            # Ensure plugin is installed first
            mise plugins install $package 2>/dev/null || true
            mise use -g ${package}@${version}
            exit $?
        fi
        ;;
    npm)
        if command -v npm >/dev/null 2>&1; then
            echo "Installing npm package: $package"
            npm install -g $package
            exit $?
        fi
        ;;
    *)
        echo "Unknown type: $type (entry: $1)"
        exit 1
        ;;
esac
