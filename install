#!/usr/bin/env zsh

BASE_DIR=$( cd $( dirname ${(%):-%x} ) &> /dev/null && pwd )

# Bootstrap: brew must be first
${BASE_DIR}/brew/install

# Install tools from tools.conf (in order, respecting dependencies)
# Phase 1: brew packages (curl early for SSL)
grep '^brew:' ${BASE_DIR}/tools.conf | while read entry; do
    ${BASE_DIR}/lib/install-tool "$entry"
done

# Phase 2: shell configs
${BASE_DIR}/bash/install
${BASE_DIR}/zsh/install

# Phase 3: mise (version manager)
${BASE_DIR}/mise/install
. ${HOME}/.zshrc

# Phase 4: mise-managed tools
grep '^mise:' ${BASE_DIR}/tools.conf | while read entry; do
    ${BASE_DIR}/lib/install-tool "$entry"
done
. ${HOME}/.zshrc

# Phase 5: npm packages (requires node from phase 4)
grep '^npm:' ${BASE_DIR}/tools.conf | while read entry; do
    ${BASE_DIR}/lib/install-tool "$entry"
done

# Phase 6: brew casks
grep '^brew-cask:' ${BASE_DIR}/tools.conf | while read entry; do
    ${BASE_DIR}/lib/install-tool "$entry"
done

# Phase 7: tools with custom configs
${BASE_DIR}/git/install
${BASE_DIR}/vim/install
